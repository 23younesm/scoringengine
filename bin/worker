#!/usr/bin/env python

import os
import sys

from scoring_engine.celery_app import celery_app
from scoring_engine.config import config

if 'EXAMPLE' in os.environ and os.environ['EXAMPLE'].lower() == 'true':
    print("EXAMPLE environment variable is true, so skipping running the worker.")
    sys.exit(0)

workdir = os.path.join(os.path.dirname(os.path.abspath(__file__)), '../scoring_engine/engine')
celery_args = [
    'celery',
    '--workdir={0}'.format(workdir),
    '--loglevel=info',
    'worker',
]

if config.worker_num_concurrent_tasks != -1:
    celery_args.append('--concurrency={0}'.format(config.worker_num_concurrent_tasks))

celery_app.start(argv=celery_args)
