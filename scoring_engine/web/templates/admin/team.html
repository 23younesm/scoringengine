{% extends 'admin/adminbase.html' %}
{% block title %}Admin - {{team.name}}{% endblock %}

{% block head %}
    {{ super() }}
<!--         <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/dataTables.bootstrap.min.js') }}"></script>
        <link href="{{ url_for('static', filename='css/dataTables.bootstrap.min.css') }}" rel="stylesheet" /> -->
        <!-- <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet"> -->

        <script src="http://vitalets.github.io/x-editable/assets/jquery/jquery-1.9.1.min.js"></script>
        <script src="http://vitalets.github.io/x-editable/assets/mockjax/jquery.mockjax.js"></script>

        <!-- bootstrap -->
        <link href="http://vitalets.github.io/x-editable/assets/bootstrap/css/bootstrap.css" rel="stylesheet">
        <link href="http://vitalets.github.io/x-editable/assets/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
        <script src="http://vitalets.github.io/x-editable/assets/bootstrap/js/bootstrap.js"></script>

        <!-- x-editable (bootstrap) -->
        <link href="http://vitalets.github.io/x-editable/assets/x-editable/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet">
        <script src="http://vitalets.github.io/x-editable/assets/x-editable/bootstrap-editable/js/bootstrap-editable.js"></script>
<script src="http://vitalets.github.io/x-editable/assets/demo-mock.js"></script>
<script src="http://vitalets.github.io/x-editable/assets/demo.js"></script>
        <script>
            $.fn.editable.defaults.mode = 'inline';

            $(function(){
                $('#f').val('bootstrap3');
                $('#c').val('inline');

                $('#frm').submit(function(){
                    // var f = $('#f').val();
                    // $(this).attr('action', 'demo-bs3.html');
                });
            });


$(function(){

   //defaults
   $.fn.editable.defaults.url = '/post';

    //enable / disable
   $('#enable').click(function() {
       $('.editable-table .editable').editable('toggleDisabled');
   });

    //editables
    $('.editable-textfield').editable({
           url: '/post',
           type: 'text',
           pk: 1,
           name: 'username',
           title: 'Enter username'
    });

    $('#firstname').editable({
        validate: function(value) {
           if($.trim(value) == '') return 'This field is required';
        }
    });
});

   // $('.group').editable({
   //     showbuttons: false
   //  });


   $('.editable-table .editable').on('hidden', function(e, reason){
        if(reason === 'save' || reason === 'nochange') {
            var $next = $(this).closest('tr').next().find('.editable');
            if($('#autoopen').is(':checked')) {
                setTimeout(function() {
                    $next.editable('show');
                }, 300);
            } else {
                $next.focus();
            }
        }
   });

        </script>

                <style type="text/css">
            /*body {
                padding-top: 50px;
                padding-bottom: 30px;
            }
*/
            table.table > tbody > tr > td {
                height: 30px;
                vertical-align: middle;
            }

        </style>


{% endblock %}

{% block admincontent %}
<div class="container">
  <div class="row">
    <h2>{{team.name}}</h2>
    <div class="panel-body">
      {% for service in team.services %}
        <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a data-toggle="collapse" href="#collapse-{{service.id}}">{{service.name}}</a>
              </h4>
            </div>
            <div id="collapse-{{service.id}}" class="panel-collapse collapse">
              <div class="panel-body">
                <h4>IP Address: {{service.ip_address}}</h4>
                {% if service.accounts %}
                    <h4>Accounts</h4>
                    <table class="table table-striped table-bordered table-compact editable-table" style="clear: both">
                        <thead>
                              <tr>
                                <th>Username</th>
                                <th>Password</th>
                              </tr>
                            </thead>
                        <tbody>
                            {% for account in service.accounts %}
                                    <tr>
                                        <td width="65%"><a href="#" class="editable-textfield" data-type="text" data-pk="1" data-title="Enter username">{{account.username}}</a></td>
                                        <td width="65%"><a href="#" class="editable-textfield" data-type="text" data-pk="1" data-title="Enter username">{{account.password}}</a></td>
                                    </tr>
                              {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
                {% if service.environments %}
                    <h4>Environments</h4>
                    <table class="table table-striped table-bordered table-compact" style="clear: both">
                        <thead>
                          <tr>
                            <th>Matching Regex</th>
                            <th>Properties</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for environment in service.environments %}
                                    <tr>
                                        <td width="65%"><a href="#" class="editable-textfield" data-type="text" data-pk="1" data-title="Enter username">{{environment.matching_regex}}</a></td>
                                        <td>
                                            <table class="table table-striped table-bordered table-compact" style="clear: both">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                {% for property_obj in environment.properties %}
                                                    <tr>
                                                        <td width="65%"><a href="#" class="editable-textfield" data-type="text" data-pk="1" data-title="Enter username">{{property_obj.name}}</a></td>
                                                        <td width="65%"><a href="#" class="editable-textfield" data-type="text" data-pk="1" data-title="Enter username">{{property_obj.value}}</a></td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                              {% endfor %}
                        </tbody>
                    </table>
                {% endif %}

                <h4>Checks</h4>
                <table class="table table-striped table-bordered table-compact" cellspacing="0" width="100%">
                  <thead>
                    <tr>
                      <th>Round Number</th>
                      <th>Result</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for check in service.checks_reversed %}
                      <tr>
                        <td>{{check.round.number}}</td>
                        <td><a href="#" class="group" data-type="select" data-pk="1" data-value="2" data-source="/groups" data-title="Select group">Admin</a></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <script>
                    $(document).ready(function() {
                        $('#checks{{service.id}}').DataTable({
                            'paging': true,
                            'bFilter': false,
                            'bInfo': false,
                            "order": [[ 0, "desc" ]]
                        });
                    } );
                </script>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
<script>

$(function(){

   //defaults
   $.fn.editable.defaults.url = '/post';

    //enable / disable
   $('#enable').click(function() {
       $('.editable-table .editable').editable('toggleDisabled');
   });

    //editables
    $('.editable-textfield').editable({
           url: '/post',
           type: 'text',
           pk: 1,
           name: 'username',
           title: 'Enter username'
    });

    $('#firstname').editable({
        validate: function(value) {
           if($.trim(value) == '') return 'This field is required';
        }
    });
});

   $('.group').editable({
       showbuttons: true
    });


   $('.editable-table .editable').on('hidden', function(e, reason){
        if(reason === 'save' || reason === 'nochange') {
            var $next = $(this).closest('tr').next().find('.editable');
            if($('#autoopen').is(':checked')) {
                setTimeout(function() {
                    $next.editable('show');
                }, 300);
            } else {
                $next.focus();
            }
        }
   });

        </script>



        <script src="http://vitalets.github.io/x-editable/assets/demo.js"></script>

    </div>
  </div>
</div>
{% endblock %}