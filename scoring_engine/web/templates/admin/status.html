{% extends 'admin/adminbase.html' %}
{% block title %}Admin - Status{% endblock %}
{% block admincontent %}
<div class="container">
  <div class="row">
    <div class="engine_stats">
      <h4>Engine Stats</h4>
      <table class="table table-striped table-bordered table-compact">
        <tbody>
          <tr>
            <td>Worker Queue</td>
            <td>{{engine_stats['num_worker_queue']}}</td>
          </tr>
          <tr>
            <td>Finished Queue</td>
            <td>{{engine_stats['num_finished_queue']}}</td>
          </tr>
          <tr>
            <td>Round</td>
            <td>{{engine_stats['round_number']}}</td>
          </tr>
          <tr>
            <td>Passed Checks</td>
            <td>{{engine_stats['num_passed_checks']}}</td>
          </tr>
          <tr>
            <td>Failed Checks</td>
            <td>{{engine_stats['num_failed_checks']}}</td>
          </tr>
          <tr>
            <td>Total Checks</td>
            <td>{{engine_stats['total_checks']}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="round_status_bars">
      <h4>Current Round Status</h4>
      <span>Round Progress</span>
      <div class="progress">
          <div id="TotalPercent" class="progress-bar progress-bar-striped active " role="progressbar" aria-valuenow="70"
          aria-valuemin="0" aria-valuemax="100" style="width:70%">
              <span>70%</span>
          </div>
      </div>
      {% for team in blue_teams %}
        <span>{{team.name}}</span>
        <div class="progress">
          <div id="{{team.name}}Percent" class="progress-bar progress-bar-striped active progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
            <span>40%</span>
          </div>
        </div>
      {% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
function getProgress(){
    $.getJSON('/api/admin/get_round_progress', function(data) {
        $.each(data, function(key, val) {
            $("#" + key + "Percent").css('width', val + "%").attr('aria-valuenow', val);
            $("#" + key + "Percent span").text(val + "%");
            if (val < 30) {
                $("#" + key + "Percent").attr('class', 'progress-bar progress-bar-striped active progress-bar-danger');
            } else if (val < 70) {
                $("#" + key + "Percent").attr('class', 'progress-bar progress-bar-striped active progress-bar-warning');
            } else {
                $("#" + key + "Percent").attr('class', 'progress-bar progress-bar-striped active progress-bar-success');
            }
        });
    });
}

var getTotalProgress = setInterval(getProgress, 5000);
</script>
{% endblock %}